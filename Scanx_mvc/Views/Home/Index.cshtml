@{
    ViewData["Title"] = "Dashboard";
    var uploadDirectory = System.IO.Path.Combine(System.IO.Directory.GetCurrentDirectory(), "wwwroot", "uploads");

    // Ensure directory exists before accessing it
    if (!System.IO.Directory.Exists(uploadDirectory))
    {
        System.IO.Directory.CreateDirectory(uploadDirectory);
    }

    var pdfFiles = System.IO.Directory.Exists(uploadDirectory) ? System.IO.Directory.GetFiles(uploadDirectory) : new string[0];
}


<div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <img src="~/images/logo.png" alt="ScanX Logo" class="logo">
        </div>

        <!-- Upload PDF Button -->
        <button class="upload-btn" id="openUploadModal">+ Upload PDF</button>

        <nav class="sidebar-nav">
            <a href="#" class="nav-item active">
                <img src="~/images/workshop1.png" class="icon" alt="Workshop"> Workshop
            </a>
            <a href="#" class="nav-item">
                <img src="~/images/shield.png" class="icon" alt="Upgrade"> Upgrade
            </a>
        </nav>
    </aside>

    <!-- Content Area -->
    <section class="content-area">
        <h2>Welcome to ScanX</h2>
        <p>Upload and manage your scanned PDFs easily.</p>

        <!-- Uploaded PDFs List -->
        <div class="pdf-list">
            <h3>Uploaded PDFs</h3>
            <ul>
                @foreach (var file in pdfFiles)
                {
                    <li>
                        <a href="@Url.Content("~/uploads/" + System.IO.Path.GetFileName(file))" target="_blank">
                            @System.IO.Path.GetFileName(file)
                        </a>
                    </li>
                }

            </ul>
        </div>
    </section>
</div>

<!-- Upload Modal -->
<div id="uploadModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h2>Upload Pdf File</h2>

        <label for="pdfFile">Select a file to Upload</label>
        <input type="file" id="pdfFile" name="pdfFile" required>

        <label for="fileName">File Name *</label>
        <input type="text" id="fileName" name="fileName" placeholder="File Name" required>

        <div style="display: flex; justify-content: space-between;">
            <button class="close-btn" id="closeModalBtn">Close</button>
            <button class="upload-btn" id="uploadSubmit">Upload</button>
        </div>

        <p id="uploadStatus"></p>
    </div>
</div>


<!-- JavaScript for Handling Uploads -->
<script>
        document.getElementById("openUploadModal").addEventListener("click", function () {
        document.getElementById("uploadModal").style.display = "block";
    });

    document.getElementById("closeModal").addEventListener("click", function () {
        document.getElementById("uploadModal").style.display = "none";
    });

    document.getElementById("closeModalBtn").addEventListener("click", function () {
        document.getElementById("uploadModal").style.display = "none";
    });

    document.getElementById("uploadSubmit").addEventListener("click", async function (event) {
        event.preventDefault();

        let formData = new FormData();
        formData.append("pdfFile", document.getElementById("pdfFile").files[0]);
        formData.append("fileName", document.getElementById("fileName").value);

        let response = await fetch("/api/pdf/upload", {
            method: "POST",
            body: formData
        });

        let result = await response.json();

        if (result.success) {
            document.getElementById("uploadStatus").innerText = "Upload successful!";
            setTimeout(() => location.reload(), 1000);
        } else {
            document.getElementById("uploadStatus").innerText = "Upload failed: " + result.error;
        }
    });

    
</script>

<!-- Styles for Modal (Add to CSS File) -->
<style>
    .modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        box-shadow: 0px 0px 10px gray;
    }
    .modal-content {
        display: flex;
        flex-direction: column;
    }
    .close {
        cursor: pointer;
        float: right;
        font-size: 20px;
    }
</style>
